# DCT域上的QIM实现

##一、基于QIM的水印算法

简单来说，QIM算法就是使用两个量化标准，对于当前嵌入的水印（1或0），选择不同的量化表进行量化。在提取时，判断当前的值所在范围属于哪一个量化表，据此提取出当前的水印值。

QIM可以在空域、DCT域上进行。

##二、改进

参照华中科技大学校报《基于QIM的数字图像盲水印算法》，提出了一种在DCT域上嵌入水印的QIM算法。嵌入的大致流程是，首先对图像进行8×8不重叠的分块，为消除块效应，对相邻块进行行列变换，也就是说，对于相邻的两个矩阵，首先进行隔行交换，结束后进行隔列交换，然后对这些块做DCT变换，根据二值水印的各信息位对其直流分量进行量化，使量化后的系数处于两种特定的区间，最后进行反行列变换、反DCT变换，得到最终的含密图像。提取的大致流程是，首先对图像进行8×8不重叠的分块，对相邻块进行行列变换，然后对这些块做DCT变换，取出其DC系数，判断其所在区间，得到当前水印的值。

##三、具体算法

1．流程

![img](img\1.png)![img](img\2.png) 

​             嵌入流程		            提取流程

2．公式

（1）嵌入公式

![img](file:///C:\Users\RACHEL~1\AppData\Local\Temp\ksohtml\wps536E.tmp.png) 

![img](file:///C:\Users\RACHEL~1\AppData\Local\Temp\ksohtml\wps536F.tmp.png) 

（2）提取公式

 

3．Psnr~deta曲线

（1）![img](img\3.png)

（2）查看psnr~deta曲线，取deta=20;2*deta=40，d由随机数生成，范围在0到10之内。

（3）初始图像（1920*1080）

![img](img\4.png) 

（4）水印图像（43*92）

![img](img\18.png) 

（5）嵌入后图像

![img](img\5.png) 

（6）嵌入后Psnr = 47.0011

（7）提取效果

 ![img](img\6.png)

四、对嵌入后图像进行攻击

1．质量因子为90的JPEG编码

![img](img\7.png) 

2．质量因子为50的JPEG编码

![img](img\8.png) 

3．3*3中值滤波

![img](img\9.png) 

4．高斯噪声

（1）0.0001

![img](img\0.png) 

Psnr=38.7124

（2）0.01

![img](img\11.png) 

Psnr = 20.2829

5．椒盐噪声

0.001：

![img](img\12.png) 

Psnr = 34.4496

0.01：

![img](img\13.png) 

Psnr=24.9084

##四、隐写分析

对图像进行卡方分析，对比嵌入前后图像灰度值变化

![img](img\14.png) 

 

![img](img\15.png) 

 

 

##五、算法优缺点分析

1. 优点：透明性良好，能够抵抗隐写分析。

2. 缺点：鲁棒性较差，对于高斯、椒盐噪声、剪切等修改较为敏感。

##六、实验过程中遇到的问题

1．对图像分块后，一块嵌入一个水印信息也就是一比特。论文中采用“加性水印”，对于当前块，如果是奇数块，且水印信息为1，直流系数就加Δ，如果水印信息为0，直流系数减Δ；偶数块相反。Δ采用自适应原则计算而得，即嵌入时，平滑区选择较小的嵌入强度，纹理区选择较大的嵌入强度．我不太理解，如何能够仅凭当前含密图像的DC系数和Δ值即可判断出当前水印是1还是0.因此在实验中，对于DC系数的修改，采用了最原始的QIM算法，即Δ固定，d作为密钥，直接修改DC值。这也可能导致了嵌入后图片鲁棒性不够好，抵抗攻击能力差。

2．具体说来，对于DC系数，论文中所述如下图

（1）![img](img\16.png)

（2）Δ值公式：![img](img\17.png)

（3）其中：k是当前水印的序号，S（k）是当前块的方差，u是所有嵌入水印的块的方差的均值，λ和β是自由选择的参数。

（4）论文标题“盲水印”，在提取时，我们只有Δ值和含密图像。是如何能够根据当前含密图像块的DC系数值和Δ值判断出水印值呢？还是不太理解。

 